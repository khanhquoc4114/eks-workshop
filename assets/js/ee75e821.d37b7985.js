"use strict";(globalThis.webpackChunkdocusaurus=globalThis.webpackChunkdocusaurus||[]).push([[505],{8453(e,n,s){s.d(n,{R:()=>l,x:()=>t});var r=s(6540);const i={},o=r.createContext(i);function l(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),r.createElement(o.Provider,{value:n},e.children)}},8993(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"networking/networking","title":"Networking","description":"Overview","source":"@site/docs/networking/networking.md","sourceDirName":"networking","slug":"/networking/","permalink":"/eks-workshop/docs/networking/","draft":false,"unlisted":false,"editUrl":"https://github.com/khanhquoc4114/eks-workshop/tree/main/packages/create-docusaurus/templates/shared/docs/networking/networking.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Observability","permalink":"/eks-workshop/docs/observability/observibility"},"next":{"title":"Security","permalink":"/eks-workshop/docs/security/"}}');var i=s(4848),o=s(8453);const l={},t="Networking",c={},a=[{value:"Overview",id:"overview",level:2},{value:"1. Amazon VPC CNI",id:"1-amazon-vpc-cni",level:2},{value:"Overview",id:"overview-1",level:3},{value:"2. Custom Networking",id:"2-custom-networking",level:2},{value:"Overview",id:"overview-2",level:3},{value:"Steps",id:"steps",level:3},{value:"3. Prefix Delegation",id:"3-prefix-delegation",level:2},{value:"Overview",id:"overview-3",level:3},{value:"Steps",id:"steps-1",level:3},{value:"4. Network Policies",id:"4-network-policies",level:2},{value:"Overview",id:"overview-4",level:3},{value:"Steps",id:"steps-2",level:3},{value:"5. Security Groups for Pods",id:"5-security-groups-for-pods",level:2},{value:"Overview",id:"overview-5",level:3},{value:"Steps",id:"steps-3",level:3},{value:"6. Amazon VPC Lattice",id:"6-amazon-vpc-lattice",level:2},{value:"Overview",id:"overview-6",level:3},{value:"Steps",id:"steps-4",level:3},{value:"7. EKS Hybrid Nodes",id:"7-eks-hybrid-nodes",level:2},{value:"Overview",id:"overview-7",level:3},{value:"Steps",id:"steps-5",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"networking",children:"Networking"})}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"Understanding Kubernetes networking is critical for efficiently operating your cluster and applications. This guide covers Pod networking, service networking, Amazon VPC CNI configurations, VPC Lattice, and EKS Hybrid Nodes."}),"\n",(0,i.jsx)(n.p,{children:"Amazon EKS uses Amazon VPC to provide networking capabilities to worker nodes and Kubernetes Pods. The cluster consists of an AWS-managed VPC hosting the Kubernetes control plane and a customer-managed VPC hosting worker nodes and AWS infrastructure."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"1-amazon-vpc-cni",children:"1. Amazon VPC CNI"}),"\n",(0,i.jsx)(n.h3,{id:"overview-1",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"Amazon EKS officially supports the Amazon VPC CNI plugin to implement Kubernetes Pod networking. The VPC CNI provides native integration with AWS VPC and works in underlay mode where Pods and hosts share the same network layer."}),"\n",(0,i.jsx)(n.p,{children:"Worker nodes connect to the EKS control plane through the EKS public endpoint or EKS-managed elastic network interfaces (ENIs). The VPC CNI assigns Pod IP addresses from VPC subnets, making them consistent from both cluster and VPC perspectives."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"2-custom-networking",children:"2. Custom Networking"}),"\n",(0,i.jsx)(n.h3,{id:"overview-2",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"By default, Amazon VPC CNI assigns Pods IP addresses from the primary subnet. Custom networking solves IP exhaustion issues by assigning Pod IPs from secondary VPC address spaces using ENIConfig custom resources."}),"\n",(0,i.jsx)(n.h3,{id:"steps",children:"Steps"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 1:"})," Prepare environment"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"prepare-environment networking/custom-networking\n"})}),"\n",(0,i.jsx)(n.p,{children:"This creates:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Secondary CIDR range attached to VPC"}),"\n",(0,i.jsx)(n.li,{children:"Three additional subnets from secondary CIDR"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 2:"})," Review VPC architecture"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"aws ec2 describe-vpcs --vpc-ids $VPC_ID\n"})}),"\n",(0,i.jsx)(n.p,{children:"Expected output shows:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Primary CIDR: ",(0,i.jsx)(n.code,{children:"10.42.0.0/16"})]}),"\n",(0,i.jsxs)(n.li,{children:["Secondary CIDR: ",(0,i.jsx)(n.code,{children:"100.64.0.0/16"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 3:"})," List subnets"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'aws ec2 describe-subnets --filters "Name=tag:created-by,Values=eks-workshop-v2" \\\n  --query "Subnets[*].CidrBlock"\n'})}),"\n",(0,i.jsx)(n.p,{children:"Subnets include:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Public subnets (primary CIDR)"}),"\n",(0,i.jsx)(n.li,{children:"Private subnets (primary CIDR)"}),"\n",(0,i.jsx)(n.li,{children:"Secondary private subnets (secondary CIDR)"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 4:"})," Enable custom networking"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl set env daemonset aws-node -n kube-system AWS_VPC_K8S_CNI_CUSTOM_NETWORK_CFG=true\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 5:"})," Create ENIConfig resources"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl kustomize ~/environment/eks-workshop/modules/networking/custom-networking/provision \\\n  | envsubst | kubectl apply -f-\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 6:"})," Verify ENIConfig creation"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get ENIConfigs\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 7:"})," Configure automatic ENIConfig assignment"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl set env daemonset aws-node -n kube-system ENI_CONFIG_LABEL_DEF=topology.kubernetes.io/zone\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 8:"})," Provision new node group"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"aws eks create-nodegroup --region $AWS_REGION \\\n  --cluster-name $EKS_CLUSTER_NAME \\\n  --nodegroup-name custom-networking \\\n  --instance-types t3.medium --node-role $CUSTOM_NETWORKING_NODE_ROLE \\\n  --subnets $PRIMARY_SUBNET_1 $PRIMARY_SUBNET_2 $PRIMARY_SUBNET_3 \\\n  --labels type=customnetworking \\\n  --scaling-config minSize=1,maxSize=1,desiredSize=1\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 9:"})," Wait for node group creation"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"aws eks wait nodegroup-active --cluster-name $EKS_CLUSTER_NAME --nodegroup-name custom-networking\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 10:"})," Verify new nodes"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get nodes -L eks.amazonaws.com/nodegroup\n"})}),"\n",(0,i.jsx)(n.p,{children:"New nodes will use secondary CIDR for Pod IP allocation."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 11:"})," Deploy sample application\nDeploy workloads to the new node group and verify they receive IPs from the secondary CIDR range."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"3-prefix-delegation",children:"3. Prefix Delegation"}),"\n",(0,i.jsx)(n.h3,{id:"overview-3",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"Amazon VPC CNI assigns network prefixes to EC2 network interfaces to increase the number of available IP addresses and boost pod density per node. With prefix delegation, VPC CNI assigns /28 (16 IP addresses) IPv4 prefixes instead of individual secondary IP addresses."}),"\n",(0,i.jsx)(n.h3,{id:"steps-1",children:"Steps"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 1:"})," Prepare environment"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"prepare-environment networking/prefix\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 2:"})," Verify VPC CNI installation"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get pods --selector=k8s-app=aws-node -n kube-system\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 3:"})," Check CNI version"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'kubectl describe daemonset aws-node --namespace kube-system | grep Image | cut -d "/" -f 2\n'})}),"\n",(0,i.jsx)(n.p,{children:"Version must be 1.9.0 or later."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 4:"})," Confirm prefix delegation is enabled"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get ds aws-node -o yaml -n kube-system | yq '.spec.template.spec.containers[].env'\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Look for ",(0,i.jsx)(n.code,{children:'ENABLE_PREFIX_DELEGATION: "true"'})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 5:"})," Verify prefixes assigned to nodes"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'aws ec2 describe-instances --filters "Name=tag-key,Values=eks:cluster-name" \\\n  "Name=tag-value,Values=${EKS_CLUSTER_NAME}" \\\n  --query \'Reservations[*].Instances[].{InstanceId: InstanceId, Prefixes: NetworkInterfaces[].Ipv4Prefixes[]}\'\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 6:"})," Review prefix allocation\nEach node should have one or more /28 IPv4 prefixes assigned."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 7:"})," Monitor pod density\nWith prefix delegation, nodes can support significantly more pods than with secondary IP mode."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"4-network-policies",children:"4. Network Policies"}),"\n",(0,i.jsx)(n.h3,{id:"overview-4",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"Kubernetes Network Policies enable defining and enforcing rules on traffic flow between pods, namespaces, and IP blocks. They act as a virtual firewall for segmenting and securing the cluster."}),"\n",(0,i.jsx)(n.h3,{id:"steps-2",children:"Steps"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 1:"})," Prepare environment"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"prepare-environment networking/network-policies\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 2:"})," Review sample application architecture"]}),"\n",(0,i.jsx)(n.p,{children:"Each component runs in its own namespace: ui, catalog, orders, etc."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 3:"})," Verify current connectivity (no restrictions)"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl exec deployment/catalog -n catalog -- curl -s http://checkout.checkout/health\n"})}),"\n",(0,i.jsx)(n.p,{children:"Should return success response."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 4:"})," Implement default deny egress policy"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl apply -n ui -f ~/environment/eks-workshop/modules/networking/network-policies/apply-network-policies/default-deny.yaml\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 5:"})," Verify egress blocked"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl exec deployment/ui -n ui -- curl -s http://catalog.catalog/health --connect-timeout 5\n"})}),"\n",(0,i.jsx)(n.p,{children:"Should timeout."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 6:"})," Apply selective egress policy for UI"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f ~/environment/eks-workshop/modules/networking/network-policies/apply-network-policies/allow-ui-egress.yaml\n"})}),"\n",(0,i.jsx)(n.p,{children:"This allows:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Traffic to all service components"}),"\n",(0,i.jsx)(n.li,{children:"Traffic to kube-system namespace for DNS"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 7:"})," Verify UI can access catalog service"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl exec deployment/ui -n ui -- curl http://catalog.catalog/health\n"})}),"\n",(0,i.jsx)(n.p,{children:"Should succeed."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 8:"})," Verify UI cannot access database"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl exec deployment/ui -n ui -- curl -v telnet://catalog-mysql.catalog:3306 --connect-timeout 5\n"})}),"\n",(0,i.jsx)(n.p,{children:"Should timeout."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 9:"})," Apply ingress policy for catalog service"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f ~/environment/eks-workshop/modules/networking/network-policies/apply-network-policies/allow-catalog-ingress-webservice.yaml\n"})}),"\n",(0,i.jsx)(n.p,{children:"Allows traffic only from UI namespace."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 10:"})," Verify UI can access catalog"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl exec deployment/ui -n ui -- curl -v catalog.catalog/health --connect-timeout 5\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 11:"})," Verify orders cannot access catalog"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl exec deployment/orders -n orders -- curl -v catalog.catalog/health --connect-timeout 5\n"})}),"\n",(0,i.jsx)(n.p,{children:"Should timeout."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 12:"})," Apply ingress policy for catalog database"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f ~/environment/eks-workshop/modules/networking/network-policies/apply-network-policies/allow-catalog-ingress-db.yaml\n"})}),"\n",(0,i.jsx)(n.p,{children:"Allows database access only from catalog service pods."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 13:"})," Test database isolation"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl exec deployment/orders -n orders -- curl -v telnet://catalog-mysql.catalog:3306 --connect-timeout 5\n"})}),"\n",(0,i.jsx)(n.p,{children:"Should timeout, confirming database is protected."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"5-security-groups-for-pods",children:"5. Security Groups for Pods"}),"\n",(0,i.jsx)(n.h3,{id:"overview-5",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"Security Groups for Pods allow using Amazon EC2 security groups to define rules governing inbound and outbound network traffic to and from specific pods. This provides pod-level network security instead of node-level."}),"\n",(0,i.jsx)(n.h3,{id:"steps-3",children:"Steps"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 1:"})," Prepare environment"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"prepare-environment networking/securitygroups-for-pods\n"})}),"\n",(0,i.jsx)(n.p,{children:"This creates:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Amazon RDS instance"}),"\n",(0,i.jsx)(n.li,{children:"EC2 security group for RDS access"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 2:"})," Review current catalog setup"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl -n catalog get pod\n"})}),"\n",(0,i.jsx)(n.p,{children:"Shows catalog service and MySQL database pods."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 3:"})," Check catalog database endpoint"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl -n catalog exec deployment/catalog -- env \\\n  | grep RETAIL_CATALOG_PERSISTENCE_ENDPOINT\n"})}),"\n",(0,i.jsx)(n.p,{children:"Currently points to in-cluster MySQL."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 4:"})," Verify RDS security group"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'export CATALOG_SG_ID=$(aws ec2 describe-security-groups \\\n    --filters Name=vpc-id,Values=$VPC_ID Name=group-name,Values=$EKS_CLUSTER_NAME-catalog \\\n    --query "SecurityGroups[0].GroupId" --output text)\naws ec2 describe-security-groups --group-ids $CATALOG_SG_ID\n'})}),"\n",(0,i.jsx)(n.p,{children:"Security group allows:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Inbound HTTP API traffic on port 8080"}),"\n",(0,i.jsx)(n.li,{children:"All egress traffic"}),"\n",(0,i.jsx)(n.li,{children:"Access to RDS database"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 5:"})," Create SecurityGroupPolicy"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl kustomize ~/environment/eks-workshop/modules/networking/securitygroups-for-pods/sg \\\n  | envsubst | kubectl apply -f-\n"})}),"\n",(0,i.jsx)(n.p,{children:"This maps the security group to catalog service pods."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 6:"})," Recycle catalog pods"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl delete pod -n catalog -l app.kubernetes.io/component=service\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 7:"})," Wait for rollout"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl rollout status -n catalog deployment/catalog --timeout 30s\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 8:"})," Verify RDS connection"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl -n catalog logs deployment/catalog\n"})}),"\n",(0,i.jsx)(n.p,{children:"Should show connection to RDS endpoint."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 9:"})," Inspect pod ENI\nCatalog pods now have dedicated branch ENIs with the security group attached."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 10:"})," Verify trunk interface on node\nCheck node for ",(0,i.jsx)(n.code,{children:"aws-k8s-trunk-eni"})," interface created by VPC Resource Controller."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 11:"})," Test connectivity\nCatalog pods can now access RDS while other pods cannot due to security group restrictions."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"6-amazon-vpc-lattice",children:"6. Amazon VPC Lattice"}),"\n",(0,i.jsx)(n.h3,{id:"overview-6",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"Amazon VPC Lattice is an application layer networking service providing consistent connectivity, security, and monitoring for service-to-service communication across VPCs and accounts."}),"\n",(0,i.jsx)(n.p,{children:"Benefits:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Increased developer productivity"}),"\n",(0,i.jsx)(n.li,{children:"Improved security posture"}),"\n",(0,i.jsx)(n.li,{children:"Better application scalability and resilience"}),"\n",(0,i.jsx)(n.li,{children:"Deployment flexibility with heterogeneous infrastructure"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"steps-4",children:"Steps"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 1:"})," Prepare environment"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"prepare-environment networking/vpc-lattice\n"})}),"\n",(0,i.jsx)(n.p,{children:"This installs:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"IAM role for Gateway API controller"}),"\n",(0,i.jsx)(n.li,{children:"AWS Load Balancer Controller"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 2:"})," Configure security group for VPC Lattice"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'CLUSTER_SG=$(aws eks describe-cluster --name $EKS_CLUSTER_NAME --output json| jq -r \'.cluster.resourcesVpcConfig.clusterSecurityGroupId\')\nPREFIX_LIST_ID=$(aws ec2 describe-managed-prefix-lists --query "PrefixLists[?PrefixListName=="\\\'com.amazonaws.$AWS_REGION.vpc-lattice\\\'"].PrefixListId" | jq -r \'.[]\')\naws ec2 authorize-security-group-ingress --group-id $CLUSTER_SG --ip-permissions "PrefixListIds=[{PrefixListId=${PREFIX_LIST_ID}}],IpProtocol=-1"\nPREFIX_LIST_ID_IPV6=$(aws ec2 describe-managed-prefix-lists --query "PrefixLists[?PrefixListName=="\\\'com.amazonaws.$AWS_REGION.ipv6.vpc-lattice\\\'"].PrefixListId" | jq -r \'.[]\')\naws ec2 authorize-security-group-ingress --group-id $CLUSTER_SG --ip-permissions "PrefixListIds=[{PrefixListId=${PREFIX_LIST_ID_IPV6}}],IpProtocol=-1"\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 3:"})," Install Gateway API CRDs"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f https://github.com/kubernetes-sigs/gateway-api/releases/download/v1.2.0/standard-install.yaml\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 4:"})," Install VPC Lattice controller"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'aws ecr-public get-login-password --region us-east-1 \\\n  | helm registry login --username AWS --password-stdin public.ecr.aws\nhelm install gateway-api-controller \\\n    oci://public.ecr.aws/aws-application-networking-k8s/aws-gateway-controller-chart \\\n    --version=v${LATTICE_CONTROLLER_VERSION} \\\n    --create-namespace \\\n    --set=aws.region=${AWS_REGION} \\\n    --set serviceAccount.annotations."eks\\.amazonaws\\.com/role-arn"="$LATTICE_IAM_ROLE" \\\n    --set=defaultServiceNetwork=${EKS_CLUSTER_NAME} \\\n    --namespace gateway-api-controller \\\n    --wait\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 5:"})," Verify controller deployment"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get deployment -n gateway-api-controller\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 6:"})," Create GatewayClass"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f ~/environment/eks-workshop/modules/networking/vpc-lattice/controller/gatewayclass.yaml\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 7:"})," Create Gateway (Service Network)"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cat ~/environment/eks-workshop/modules/networking/vpc-lattice/controller/eks-workshop-gw.yaml \\\n  | envsubst | kubectl apply -f -\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 8:"})," Verify Gateway creation"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get gateway -n checkout\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 9:"})," Wait for Gateway to be programmed"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl wait --for=condition=Programmed gateway/${EKS_CLUSTER_NAME} -n checkout\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 10:"})," View Service Network in AWS Console\nNavigate to VPC Console \u2192 Lattice \u2192 Service Networks"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 11:"})," Configure routes\nCreate HTTPRoute resources to define traffic routing rules."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 12:"})," Test routing\nVerify traffic flows through VPC Lattice according to defined routes."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"7-eks-hybrid-nodes",children:"7. EKS Hybrid Nodes"}),"\n",(0,i.jsx)(n.h3,{id:"overview-7",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"Amazon EKS Hybrid Nodes unifies Kubernetes management across cloud, on-premises, and edge environments, providing flexibility to run workloads anywhere while maintaining centralized control."}),"\n",(0,i.jsx)(n.h3,{id:"steps-5",children:"Steps"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 1:"})," Prepare environment"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"prepare-environment networking/eks-hybrid-nodes\n"})}),"\n",(0,i.jsx)(n.p,{children:"This creates:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Transit Gateway connection to simulated remote network"}),"\n",(0,i.jsx)(n.li,{children:"EC2 instance simulating on-premises node"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 2:"})," Create SSM hybrid activation"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'export ACTIVATION_JSON=$(aws ssm create-activation \\\n--default-instance-name hybrid-ssm-node \\\n--iam-role $HYBRID_ROLE_NAME \\\n--registration-limit 1 \\\n--region $AWS_REGION)\nexport ACTIVATION_ID=$(echo $ACTIVATION_JSON | jq -r ".ActivationId")\nexport ACTIVATION_CODE=$(echo $ACTIVATION_JSON | jq -r ".ActivationCode")\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 3:"})," Create NodeConfig"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cat ~/environment/eks-workshop/modules/networking/eks-hybrid-nodes/nodeconfig.yaml \\\n| envsubst > nodeconfig.yaml\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 4:"})," Copy NodeConfig to hybrid node"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/.ssh/\nssh-keyscan -H $HYBRID_NODE_IP &> ~/.ssh/known_hosts\nscp -i private-key.pem nodeconfig.yaml ubuntu@$HYBRID_NODE_IP:/home/ubuntu/nodeconfig.yaml\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 5:"})," Install nodeadm dependencies"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'ssh -i private-key.pem ubuntu@$HYBRID_NODE_IP \\\n"sudo nodeadm install $EKS_CLUSTER_VERSION --credential-provider ssm"\n'})}),"\n",(0,i.jsx)(n.p,{children:"Installs: containerd, kubelet, kubectl, AWS SSM components"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 6:"})," Initialize hybrid node"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'ssh -i private-key.pem ubuntu@$HYBRID_NODE_IP \\\n"sudo nodeadm init -c file://nodeconfig.yaml"\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 7:"})," Verify node joined cluster"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get nodes\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Node appears with ",(0,i.jsx)(n.code,{children:"mi-"})," prefix (SSM credential provider) but in ",(0,i.jsx)(n.code,{children:"NotReady"})," state."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 8:"})," Add Cilium Helm repo"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm repo add cilium https://helm.cilium.io/\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 9:"})," Install Cilium CNI"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm install cilium cilium/cilium \\\n--version 1.17.1 \\\n--namespace cilium \\\n--create-namespace \\\n--values ~/environment/eks-workshop/modules/networking/eks-hybrid-nodes/cilium-values.yaml\n"})}),"\n",(0,i.jsx)(n.p,{children:"Configuration includes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Node affinity for hybrid nodes only"}),"\n",(0,i.jsx)(n.li,{children:"Cluster-pool IPAM mode"}),"\n",(0,i.jsx)(n.li,{children:"Dedicated CIDR (10.53.0.0/16) for hybrid node pods"}),"\n",(0,i.jsx)(n.li,{children:"/25 subnets per node (128 IPs)"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 10:"})," Wait for node to become Ready"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl wait --for=condition=Ready nodes --all --timeout=2m\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 11:"})," Verify hybrid node status"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get nodes\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Hybrid node should now show ",(0,i.jsx)(n.code,{children:"Ready"})," status."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 12:"})," Route traffic to hybrid node\nDeploy workloads with node selectors targeting hybrid nodes."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Step 13:"})," Test cloud bursting\nScale applications to utilize both cloud and hybrid nodes."]}),"\n",(0,i.jsx)(n.hr,{})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);